/*
 * ssdCascadingDropDown jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/cascading-dropdown
 * Copyright (c) 2016 Sebastian Sulinski
 * Version: 1.3.1 (24-MAY-2016)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(t,a){t.fn.ssdCascadingDropDown=function(e){"use strict";function n(t){return t===a||""===t||t===!1||t.length<1}function r(t,a){return t in a}function i(t){t.preventDefault(),t.stopPropagation()}function u(a){return t("[data-"+k.attrDataGroup+'="'+a+'"]')}function l(a,e){return t("[data-"+k.attrDataGroup+'="'+a+'"][data-'+k.attrDataId+'="'+e+'"]')}function o(a,e){return t("[data-"+k.attrDataGroup+'="'+a+'"][data-'+k.attrDataTarget+'="'+e+'"]')}function c(a){return t("[data-"+k.attrDataReplacementContainer+'="'+a+'"]')}function f(t){var e={group:t.data(k.attrDataGroup),id:t.data(k.attrDataId),target:t.data(k.attrDataTarget),url:t.data(k.attrDataUrl),value:t.val(),isValueEmpty:function(){return n(this.value)},replacementContainer:t.data(k.attrDataReplacement),"final":t.data("final"),isFinal:function(){return this["final"]!==a}};return e.targetObject=l(e.group,e.target),e.targetDefaultLabel=e.targetObject.data(k.attrDataDefaultLabel),e.parent=o(e.group,e.id),e.parentUrl=e.parent.data(k.attrDataUrl),e}function s(){var t='<option value="';return t+=n(arguments[1])?"":arguments[1],t+='">',t+=n(arguments[0])?"Select one":arguments[0],t+="</option>"}function d(t){return s(t)}function p(t,a){return U.formatOptions(t,a[k.indexMenu])}function D(t,a){var e=c(t);0!==e.length&&(n(a)&&(a=e.data(k.attrDataReplacementDefault)),e.html(a))}function m(t,a,e){a.html(d(e)).prop("disabled",!0);var r=a.data(k.attrDataTarget);if(!n(r)){var i=l(t,r),u=i.data(k.attrDataDefaultLabel);i.length>0&&m(t,i,u)}}function h(a){var e=a.data(k.attrDataGroup),r=u(e).not(":disabled"),i=[];return t.each(r,function(){var a=t(this).val();n(a)||i.push({name:t(this).prop("name"),value:t(this).val()})}),i}function g(a){return t.param(a)}function v(t){if(!t)throw new Error("Invalid data received!");if(!t.success){if(!r(k.indexError,t))throw new Error("There was a problem with the request!");return k.errorCallback(t[k.indexError],t),!1}return!0}function b(a,e){return n(e.parent)||n(e.parentUrl)?void D(e.replacementContainer,""):void t.getJSON(e.parentUrl+"?"+g(e.selection),function(t){v(t)&&(C(a,e,t),D(e.replacementContainer,t[k.indexReplacement]))})}function C(t,a,e){return a.isFinal()?k.finalCallback(t,a,e,U):k.nonFinalCallback(t,a,e,U)}function R(a,e){t.getJSON(e.url+"?"+g(e.selection),function(n){v(n)&&(C(a,e,n),r(k.indexMenu,n)&&t.when(p(e.targetDefaultLabel,n)).then(function(t){e.targetObject.html(t).prop("disabled",!1)}),r(k.indexReplacement,n)&&D(e.replacementContainer,n[k.indexReplacement]))})}function x(a){a.on("change",function(a){if(i(a),!t(this).is(":disabled")){var e=f(t(this));if(!n(e.url))return n(e.target)||m(e.group,e.targetObject,e.targetDefaultLabel),e.selection=h(t(this)),n(e.value)?void b(t(this),e):void R(t(this),e)}})}function w(t,a){return!n(a.attr(t))}function L(a){var e=t.Deferred(),n=[k.attrDataGroup,k.attrDataId,k.attrDataUrl,k.attrDataTarget,k.attrDataDefaultLabel,k.attrDataReplacement];return k.verify?t.each(n,function(t,r){r="data-"+r,w(r,a)||console.log(a.prop("name")+" is missing attribute "+r),t+1===n.length&&e.resolve()}):e.resolve(),e.promise()}function O(t){t.html(d(t.data(k.attrDataDefaultLabel))).prop("disabled",!0)}function G(){var a=t("."+k.classReplacementContainer);t.each(a,function(){t(this).html(t(this).data(k.attrDataReplacementDefault))})}var U=this,k=t.extend({attrDataGroup:"group",attrDataId:"id",attrDataUrl:"url",attrDataTarget:"target",attrDataDefaultLabel:"default-label",attrDataReplacement:"replacement",attrDataReplacementContainer:"replacement-container",attrDataReplacementDefault:"default-content",classReplacementContainer:"cascadingContainer",indexSuccess:"success",indexError:"error",indexMenu:"menu",indexReplacement:"replacement",verify:!0,nonFinalCallback:function(t,a,e,n){},finalCallback:function(t,a,e,n){},errorCallback:function(t,a){console.warn(t)}},e);return this.formatOptions=function(a,e){var n=t.Deferred(),r=d(a);return t.each(e,function(t,a){r+=s(a.name,a.value),t+1===e.length&&n.resolve(r)}),n.promise()},G(),this.each(function(){var a=t(this);O(a.not(":enabled")),t.when(L(a)).then(function(){x(a)})})}}(jQuery);